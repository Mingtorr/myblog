+++
author = "Mincheol Park"
categories = ["SQLD"]
tags = ["SQLD"]
date = 2020-09-10T12:11:40+09:00
description = "반정규화를 통한 성능향상 전략"
title = "반정규화와 성능"
+++

# 반정규화(De-Nomalization)의 정의

> 정규화를 수행하지 않은 모델을 지칭한다.  
>  정규화된 엔터티, 속성, 관계에 대해 시스템의 성능향상과 개발(Development)과 운영(Maintenance)의 단순화를 위해 중복, 통합, 분리 등을 수행하는 데이터 모델링의 기법

좁은 의미의 반정규화는 데이터를 중복하여 성능을 향상시키기 위한 기법을 뜻하여, 넓은 의미의 반정규화는 성능을 향상시키기 위해 정규화된 데이터 모델에서 중복, 통합, 분리 등을 수행하는 모든 과정을 의미한다.

<br>

**반정규화를 수행하는 경우**

- 데이터를 조회할 때 대량의 디스크I/O 량으로 인한 성능 저하
- 경로가 너무 멀어 조인으로 인한 성능저하가 예상되는 경우
- 칼럼을 계산하여 읽을 때 성능이 저하될 것이 예상되는 경우
- 정규화의 함수적 종속관계는 위반하지 않지만 데이터의 중복성을 증가시켜야만 데이터조회의 성능을 향상되는 경우

<br>

**반정규화를 프로젝트에서는 설계단계에서 기술적으로 수행하지 않으면?**

- 성능이 저하된 데이터베이스가 생성
- 구축단계 혹은 시험단계에서 반정규화를 적용할 때 수정에 대한 노력비용이 많이 들게 된다.

<br>

정규화와 반정규화 사이에는 Trade-Off 관계 즉, 마치 저울추가 양쪽에 존재하여 한쪽이 무거워지면 다른 쪽은 위로 올라가는 것처럼 정규화만을 강조하다 보면 성능의 이슈가 발생될 수 있고 반정규화를 과도하게 적용하다 보면 데이터 무결성이 깨질 수 있는 위험이 증가하게 되는 것이다.  
따라서 **반드시 데이터 무결성을 보장할 수 있는 방법을 고려한 이후에 반정규화를 적용하도록 해야 한다.**

<p align="center"><img src="/img/blog/SQL_089.jpg"></p>
<br>

---

# 반정규화의 적용방법

<p align="center"><img src="/img/blog/SQL_090.jpg"></p>
<br>

**`1. 반정규화 대상을 조사한다.`**  
데이터가 대량이고 성능이 저하될 것으로 예상이 되면 다음 4가지 경우

- 자주 사용되는 테이블에 접근(Access)하는 프로세스의 수가 많고 항상 일정한 범위만을 조회하는 경우
- 테이블에 대량의 데이터가 있고 대량의 데이터 범위를 자주 처리하는 경우에서 **처리범위를 일정하게 줄이지 않으면 성능을 보장할 수 없을 경우**
- 통계성 프로세스에 의해 통계 정보를 필요로 할 때 별도의 통계테이블(반정규화 테이블)을 생성한다.
- 테이블에 지나치게 많은 조인(JOIN)이 걸려 데이터를 조회하는 작업이 기술적으로 어려울 경우

<br>

**`2. 반정규화의 대상에 대해 다른 방법으로 처리할 수 있는지 검토한다.`**

- **지나치게 많은 조인(JOIN)이 걸려 데이터를 조회하는 작업이 기술적으로 어려울 경우** 뷰(VIEW)를 사용하면 이를 해결할 수도 있다. 뷰가 조회의 성능을 향상시키는 역할을 수행하지는 않는다. 다만 개발자별로 SQL문장을 만드는 방법에 따라 성능저하가 나타날 수 있으므로 성능을 고려한 뷰를 생성하여 개발자가 뷰를 통해 접근하게 함으로써 성능저하의 위험을 예방하는 것도 좋은 방법이 된다.

<br>

- **대량의 데이터처리나 부분처리에 의해 성능이 저하되는 경우**에 클러스터링을 적용하거나 인덱스를 조정함으로써 성능을 향상시킬 수 있다. 클러스터링을 적용하는 방법은 대량의 데이터를 특정 클러스터링 팩트에 의해 저장방식을 다르게 하는 방법이다. 이 방법의 경우 데이터를 입력/수정/삭제하는 경우 성능이 많이 저하되므로 조회중심의 테이블이 아니라면 생성하면 안되는 오브젝트이다. 다만, 조회가 대부분이고 인덱스를 통해 성능향상이 불가능하다면 클러스터링을 고려할 만하다. 또한 인덱스를 통해 성능을 충분히 확보할 수 있다면 인덱스를 조정하여 반정규화를 회피하도록 한다.

<br>

- **대량의 데이터**는 Primary Key의 성격에 따라 부분적인 테이블로 분리할 수 있다. 즉 파티셔닝 기법(Partitioning)이 적용되어 성능저하를 방지할 수 있다. 인위적인 테이블을 통합/분리하지 않고 물리적인 저장기법에 따라 성능을 향상시킬 수 있는 파티셔닝을 고려해 볼 수 있다. 이 경우는 데이터가 특정 기준(파티셔닝 키)에 의해 다르게 저장되고 파티셔닝 키에 따른 조회가 될 때 성능이 좋아지는 특성이 있다. 따라서 특정 기준에 의해 물리적인 저장공간이 구분될 수 있고 트랜잭션이 들어올 때 일정한 기준에 의해 들어온다면 파티셔닝 테이블을 적용하여 조회의 성능을 향상시키는 것도 좋은 방법이 될 수 있다.

<br>

- 응용 애플리케이션에서 로직을 구사하는 방법을 변경함으로써 성능을 향상시킬 수 있다. 응용 메모리 영역에 데이터를 처리하기 위한 값을 캐쉬한다든지 중간 클래스 영역에 데이터를 캐쉬하여 공유하게 하여 성능을 향상 시키는 것도 성능을 향상시키는 방법이 될 수 있다.

<br>

**`3. 반정규화를 적용한다.`**

- 반정규화를 하는 대상으로는 테이블, 속성, 관계에 대해 적용할 수 있으며 꼭 테이블과 속성, 관계에 대해 중복으로 가져가는 방법만이 반정규화가 아니고 테이블, 속성, 관계를 추가할 수도 있고 분할할 수도 있으며 제거할 수도 있다.
  <br>
  <br>

---

# 반정규화 기법

테이블, 칼럼, 관계에 대해 반정규화가 있으며 종합적으로 고려해서 적용해야 한다.

<br>
<p align="center"><img src="/img/blog/SQL_091.jpg"></p>
<br>
<p align="center"><img src="/img/blog/SQL_092.jpg"></p>
<br>
<p align="center"><img src="/img/blog/SQL_093.jpg"></p>
<br>

<br>
<br>
출처: SQL 전문가 가이드 - KDB 한국데이터베이스진흥원     
     
사진출처 : DB가이드넷  - http://www.dbguide.net/
